//
// MIT License
// Copyright (c) 2019 Snekoff. All rights reserved.
//

Заметки Another D&D simulator

  Внешний мир/Глобальная карта

В Идеале мир живёт своей жизнью пока идёт приключение (A-life).
На начальном этапе (первая загрузка приключения) происходит генерация мира. Я не бог, и не собираюсь сразу хвататься за создание мира с адекватными городами, дорогами и речками. Достаточно зарание заданной карты (пока не думал как именно её задать, так как она должна быть здоровенной, настолько что-бы за приключение путешественники не могли найти непрогруженных квадратов и тд, по факту целую планету, но тут уже надо искать готовые миры).
Тоесть имеем карту, на ней есть Континенты, океаны, страны, водоёмы, города и наконец деревушки храмы и тд. Думаю разбить карту на участки, поскольку приключения имеют смысл в некоторых териториальных рамках. но ведь никто не запрещал после одного отправиться в другое?)
Для жилых мест нужно проставить коефициенты так, навскидку: Обороноспособность, Адекватность власти, Зажиточность(быт и инструменты), Технологическое развитие, Довольство населения?, Наличие/Сумма денег(не путать с зажиточностью), Население, (Что-то из Соотношений аграрное/промышленное, количество богатых/количество бедных было бы неплохо).
Не забыть что в городах помимо своих капиталов, состоящих из денег жителей и властителей, есть ещё купцы, так сказать внейшний капитал, купцы собирают караваны, которые должны в идеале закупать товары в местах где подешевле и продавать где по-дороже. Либо привозить на заводы.
В сёлах живут люди которые за время Эволюции могут поднабраться опыта и стать непобедимыми для нападающих бандитов.
Собственно про саму Эволюцию, мир должен "прожить" некоторое время перед началом Путешествия. В идеале, опять-же, это даст разнообразие миру, как различные покинутые по тем или иным причинам места, шахты, храмы и тд. Новые города могут появляться, в них скорее всего будут квесты на зачистку округи, и всякое не особо замороченое. При создании такого города или селения уровень(сила) жителей напрямую зависит от агрессивности среды.
Разнообразные квесты и соответственно суммы для них (деньги не беруться из воздуха, а есть реально наличными у дающего квест).
Путешественникам нужно будет оценивать сумму награды, поскольку может случиться другой квест с гораздо более выгодными условиями. Персонаж в награду отдаёт сумму денег в зависимости от важности для него, если это предмет/задание нужно но не необходимо то награда минимальна, допустим до 10% от его капитала (я сейчас рассматриваю скорее селян и горожан, с небольшими суммами при себе).
Если задание напрямую влияет на виживание персонажа, то он может отдать всё, с некоторой вероятностью.
Во время путешествия можно будет встретить следы разбоя можно встретить ремонтные работы, забытые вещи, клады и детские домии на деревьях (шутка, но почему бы и нет).
У скрытых мест будет коефициент сложности обнаружения, иначе говоря сколько надо прокинуть на внимательность что-бы заметить.
Бандиты могут прокачиваться при нападениях на деревни, от уровня зависит их лут.

  Економика

Есть масса денег. Которая движется с определенной скоростью. Скорость можно определить из формулы Економики. Если Сумма денег не совпадает с реальной (надо придумать как сравнивать) то ведётся нечестная игра.
При создании персонажа сумма полученная персонажем добавляется к массе денег. Есть механизм у страны создания денег. При добавлении нужно пересчитать скорость оборота. От скорости оборота зависит частота смены товаров у продавцов, и наличие у них собственно наличности. Есть фальшивомонетчики. Это тоже деньги и только специалист может их отличить. ( Если у персонажа есть как фальшивые так и оригинальные - это ещё механизм защиты от читерства )
Есть тайники, они входят в сумму денег. Уничтожение денег приводит к увеличению суммы в тайнике. Общая масса в этом случае неизменна.

  Религия

Не вижу смысла вмешиваться, богов и так достаточно, храмы бы распределить территориально, но это задача с низким приоритетом

  Карта приключения/Средняя по масштабу

Есть разные террайны, есть у них проходимость (если её нет, а на момемнт написания я этого не знаю, то не думаю что сложно их проставить).
От сложности террайна зависит скорость путешественников, не забыть про разные модификаторы (рейнджер в отряде, баф скорости, крилья и тд.).
Надо придумать способ определения степени угрозы, можно, конечно, задать глобальный шанс события/encounter, потом внутри шанс на доброе/нейтральное/злое, но мне такое не очень нравиться. В идеале надо оценить возможность события в принципе, в труднодоступных для живых существ местах не так уж просто найти событие/противника. В то время как вблизи городов события происходят постоянно, другой вопрос что не все имеют смысл для путешествия.
В идеале реальную Карту видит мастер, он и решает как направить путешественников, но вариант, с пробросом бдительности каждый час, тоже не лишён привлекательности. Второй вариант создаст необходимое разнообразие, но всёравно нужен мастер что-бы не допустить ухода от области задания. Можно, конечно, насовать много разнообразных способов прийти к сюжетной точке, которая направит куда надо (23 тысячи домиков с инструкциями по радиусу от места куда надо прийти, хоть в один путешественники заглянут), но это очень грубо.
*Не забыть реализовать Локатор, указывающий направление, на координаты точки. (понадобиться и при тестировании и при игре, для всяких поисковых спэлов). ** С заданием точности/погрешности.
**Локатор можно даже при поиске пути использовать, при грамотной реализации карты.

  Поле боя/Крупный масштаб (Поле клеточек, 5фт. каждая)

Я так и не решусь никак доделать поле боя. Должно быть 3d, поскольку 2д не соответствует требованиям.
Надо сделать генерацию деревьев. А так-же рек, пещер, городов.
Генерацию домов может получиться взять из модуля создания лабиринтов, как и создание внутренностей города (вдруг надо будет), город это лабиринт где вместо сплошных стен есть дома, у которых есть входы.

  Лабиринты/Подземелья

Я к моменту написания в процессе создания алгоритма создания лабиринтов. Алгоритм вычитал в инете и дополнил своими идеями. От этого Алгоритм стал немного громоздким, но ему не надо сильную оптимальность, а если надо то буду думать.
Суть алгоритма:
1 этап. всё поле - стены. Накладываються ограничения местности, при этом форма лабиринта произвольная, тоесть если случилось куча провалов в земле, то алгоритму пустые пятна на поле не повредят.
2 этап. пользователю(Мастеру) предлагаеться задать комнаты в лабиринте, если они нужны, в этих комнатах может даже не быть входов, а к примеру портал, или дырка в потолке, что превратит комнату в ловушку, это уже на извращённый ум Мастера.
        Комнаты могут быть любых форм, на момент написания я думаю над интеграцией комнаты в комнату и созданием произвольной формы в удобной пользователю форме.
		В Комнатах можно устанавливать Триггеры, основную суть комнат я отвёл сюжету. Мастер решит что там должно произойти, или какое условие должно выполниться. Думаю даже изменение лабиринта этим триггером можно будет сделать.
		Наполнение комнат мебелью и прочей утварю тоже либо будет за Мастером, либо, возможно, таки алгоритмом шаблонов интерьера комнат.
3 этап. Собственно само создание лабиринта, от пользователя потребуеться задать сложность, либо она уже будет задана путешествием/местностью/богом/... Чем легче лабиринт тем в нём больше прямых участков. Про ловушки не думал, это будут последние этапы генерации.
        При максимальной сложности корридоры будут поворачивать с вероятностью 3/4 каждые 2 клеточки (минимальная толщина стен 1 клеточка (5 фт.)) и с вероятностью 1/4 идти прямо. При невозможности повернуть выбираеться другой путь. При невозможности копать тунели дальше (тупик) - перенести "крота" в случайное место прорытых тунелей. Начать копать. Остановку кроме костыля пока не придумал.
4 этап ???


Problem 1
  Как хранить инфу про клеточку?
    1. Для глобальной карты.
	2. Для карты квеста.
	3. Для местности.

	Варианты:
	  3.1. Создать для всех всозможных комбинаций интовое представление(невозможно). Как итог имеем минимум данных на жёстком диске - максимум в памяти, максимум человеческого ресурса.
	  3.2. Создать структуры и вектора векторов тем самым расплодив поле на много шаров/слоёв. Основной слой - местность, Дополнительные: Двери и мебель, Ящики и лутабельное, Ловушки, Триггеры ...
	    Плюс в том что можно подключать и отключать слои без какого бы то не было напряга. Так не надо проверять есть ли тут мебель допустим для призрака. Минус в многих копиях поля и соответсвенно в сохранении лабиринта.
	  3.3. Улучшение/Дополнение второго варианта: Вместо структур Иерархия классов. тогда можно хранить лишь одну копию, в каждой клеточке которой будет vector<Base_class_0>. Итог - трёхмерная матрица неизвестной размерности, точнее известной, но с пустыми местами.
        Проблема:
          1. Хранение поля.
          2. Структура иерархии
          Решение:
			1.1. Сохранять данные для каждой клеточки отдельно. Первыми идут координаты, потом количество классов внутри(n), потом n айдишников. После матрицы вывод классов по-отдельности для каждого важно присутствие идентификатора и к какому классу принадлежит.
            1.2. Сохранять данные в виде {координаты, классы{класс 1{параметры}, класс 2 ...}}
			2.1. (Мысли) Базовый класс должен быть наверное всего-лишь интерфейсом, что-бы не дублироваться. В нём могут быть поля: id, class_name, name, item_id??, item_name??.
              Класс входов (Закрыт/открыт, блокируемый?, заблокирован?, Замок_id) Замок_id разделить по регионам, дабы примерно представлять местонахождение замка/ключа.
